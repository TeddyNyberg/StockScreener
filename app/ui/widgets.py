from PySide6.QtCore import Signal
from PySide6.QtWidgets import QHBoxLayout, QWidget,QLineEdit, QPushButton
from app.ui.helpers import lookup_and_open_details


class SearchWidget(QWidget):
    search_requested = Signal(object)
    message_displayed = Signal(str)

    def __init__(self, parent=None):
        super().__init__(parent)
        self.init_ui()

    def init_ui(self):
        self.setMaximumWidth(250)

        layout = QHBoxLayout()
        layout.setContentsMargins(0, 0, 0, 0)

        self.search_bar_input = QLineEdit()
        self.search_bar_input.setPlaceholderText("Enter ticker")
        self.search_bar_input.returnPressed.connect(self.handle_search)
        layout.addWidget(self.search_bar_input)

        self.search_button = QPushButton("Search")
        self.search_button.clicked.connect(self.handle_search)
        layout.addWidget(self.search_button)

        self.setLayout(layout)

    def handle_search(self):
        ticker = self.search_bar_input.text().strip().upper()
        lookup_and_open_details(ticker, display_error_func=self.message_displayed.emit)
        self.search_bar_input.clear()


